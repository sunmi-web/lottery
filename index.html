<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>九宫格抽奖活动</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<meta name="format-detection" content="telephone=no" />
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/style.css">
</head>

<body>

<!--各种弹框-->

<!--登陆后再来-->
<div class="window login" style="display: none">
     <img src="images/15.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--下单后再来-->
<div class="window order" style="display: none">
     <img src="images/14.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--没中奖-->
<div class="window noprize" id="#alert-noprize" style="display:none">
     <img src="images/29.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--奖池已空-->
<div class="window empty" id="alert-empty" style="display: none" >
     <img src="images/25.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--yuan1-->
<div class="window yuan1" id="alert-yuan1" style="display: none">
     <img src="images/17.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--yuan2-->
<div class="window yuan2" id="alert-yuan2"style="display: none">
     <img src="images/18.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--yuan3-->
<div class="window yuan3" id="alert-yuan3" style="display:none">
     <img src="images/19.png">
     <a class="btn" onclick="close()" ><img src="images/24.png"></a></div>
<!--yuan5-->
<div class="window yuan5" id="alert-yuan5" style="display:none">
     <img src="images/5yuan.png">
     <a class="btn" onclick="close()"><img src="images/24.png"></a></div>
<!--一等奖-->
<div class="window champion" id="alert-first" style="display:none">
     <img src="images/20.png">
     <form>
	         <input type="text" id="input1" name="name" placeholder="请输入姓名">
	         <input type="text" id="input2" name="mobile" placeholder="请输入手机号码" maxlength="11">
	         <input type="text" id="input3" name="mobile" placeholder="填写详细地址" >
	  </form>
     <img src="images/24.png" class="btn" style="top: 35vh"></div>
<!--二等奖-->
<div class="window second" id="alert-second" style="display:none">
     <img src="images/21.png">
     <form>
	         <input type="text" id="input1" name="name" placeholder="请输入姓名">
	         <input type="text" id="input2" name="mobile" placeholder="请输入手机号码" maxlength="11">
	         <input type="text" id="input3" name="mobile" placeholder="填写详细地址" >
	  </form>
     <img src="images/24.png" class="btn" style="top: 35vh"></div>
<!--三等奖-->
<div class="window champion" id="alert-third" style="display:none">
     <img src="images/chenghai.png">   
     <img src="images/24.png" class="btn" style="top: 35vh"></div>
<!--分享-->
<div class="share" style="display: none"><img src="images/27.png"></div>
<!--遮罩-->
<div class="popout" style="display: none"></div>



	<div class="mainbody">
		<img src="images/bgtop.png">
		<div id="lottery">
			<table style="position: absolute; border-spacing:6px;"   >
				<tr >
					<td class="lottery-unit lottery-unit-0"><img src="images/101.png"></td>
					<td class="lottery-unit lottery-unit-1"><img src="images/102.png"></td>
					<td class="lottery-unit lottery-unit-2"><img src="images/103.png"></td>
				</tr>
				<tr>
					<td class="lottery-unit lottery-unit-7"><img src="images/104.png"></td>
					<td colspan="1" rowspan="1"><a href="#"><img src="images/105.png"></a></td>
					<td class="lottery-unit lottery-unit-3"><img src="images/106.png"></td>
				</tr>
				<tr>
					<td class="lottery-unit lottery-unit-6"><img src="images/107.png"></td>
					<td class="lottery-unit lottery-unit-5"><img src="images/108.png"></td>
					<td class="lottery-unit lottery-unit-4"><img src="images/109.png"></td>
				</tr>
			</table>
			<img src="images/2.png" style="margin-top: -70px">
		</div>
		<img src="images/foot.png" >
	</div>



  <script src="js/jquery-1.8.3.min.js"></script>
  <script type="text/javascript">
var lottery={
	index:-1,	//当前转动到哪个位置，起点位置
	count:0,	//总共有多少个位置
	timer:0,	//setTimeout的ID，用clearTimeout清除
	speed:20,	//初始转动速度
	times:0,	//转动次数
	cycle:50,	//转动基本次数：即至少需要转动多少次再进入抽奖环节
	prize:-1,	//中奖位置
	init:function(id){
		if ($("#"+id).find(".lottery-unit").length>0) {
			$lottery = $("#"+id);
			$units = $lottery.find(".lottery-unit");
			this.obj = $lottery;
			this.count = $units.length;
			$lottery.find(".lottery-unit-"+this.index).addClass("active");
		};
	},
	roll:function(){
		var index = this.index;
		var count = this.count;
		var lottery = this.obj;
		$(lottery).find(".lottery-unit-"+index).removeClass("active");
		index += 1;
		if (index>count-1) {
			index = 0;
		};
		$(lottery).find(".lottery-unit-"+index).addClass("active");
		this.index=index;
		return false;
	},
	stop:function(index){
		// index = index;
		this.prize=index;
		// console.log(2);
		// this.run();
		return false;

	}
};

function roll(){
	clearTimeout(lottery.timer);
	lottery.times += 1;
	lottery.roll();
	if (lottery.times > lottery.cycle+10 && lottery.prize==lottery.index) {
		lottery.prize=-1;
		lottery.times=0;
		click=false;
		console.log(2);
		setTimeout(showAlert, 1000);
	}else{
		if (lottery.times<lottery.cycle) {
			lottery.speed -= 10;
		}else if(lottery.times==lottery.cycle) {
			// var index = Math.random()*(lottery.count)|0;
			// fn();
			// console.log(2);
		}else{
			if (lottery.times > lottery.cycle+10 && ((lottery.prize==0 && lottery.index==7) || lottery.prize==lottery.index+1)) {
				lottery.speed += 110;
			}else{
				lottery.speed += 20;
			}
		}
		if (lottery.speed<40) {
			lottery.speed=40;
		};
		//console.log(lottery.times+'^^^^^^'+lottery.speed+'^^^^^^^'+lottery.prize);
		lottery.timer = setTimeout(roll,lottery.speed);
	}
	return false;
}

//请求
function activityQuery(api,params,callback){
	var api_url = "http://wxyx.ideliver1.cn/yx20160328/Public/app/?service=";
    if(typeof(api_url) == 'string'){
        var fullapi = api_url + api;
    }
    $.ajax({
        async      : true,
        url        : fullapi,
        method     : 'GET',
        data:params,
        success    : function(r){
            if(r.ret == 200){
                callback(r);
            }
        }
    });
}
	var r = {};
	r.data = {};
// console.log(r);
		r.data.code = '4';
		r.data.prizeid=2;

var setStop = function (){
		switch(r.data.code){
			// case '-4':
			// $("")
			// break;
			case '0':
				lottery.stop(5);
				$('#alert-noprize').show()
			break;
			case '999999':

			break;
			case '-2':
	            $('#alert-empty').show();
			break;
			case '1':
				console.log('Coming')
				
				if(r.data.prizeid==4){
					console.log("Coming.I'm in");
					lottery.stop(6);
				};
				if(r.data.prizeid==5){
					lottery.stop(2);
				};
				if(r.data.prizeid==6){
					lottery.stop(0);
				};
	            if(r.data.prizeid==7){
					lottery.stop(4);
				};

			break;
			case '3':
			  // code=3,prizeid=>xx//三等奖
			    lottery.stop(7);
			break;
			case '4':
	              if(r.data.prizeid==2){
	              	lottery.stop(3)
	              };
	              if(r.data.prizeid==1){
	              	lottery.stop(1)
	              };
			break;
		}
}
var showAlert = function(){
	// $('#alert-yuan3').show();
	switch(r.data.code){
		// case '-4':
		// $("")
		// break;
		case '0':
			lottery.stop(5);
			$('#alert-noprize').show()
		break;
		case '999999':

		break;
		case '-2':
            $('#alert-empty').show();
		break;
		case '1':
			console.log('Coming')
			
			if(r.data.prizeid==4){
				console.log("Coming.I'm in");
				$('#alert-yuan3').show()
			};
			if(r.data.prizeid==5){
				$('#alert-yuan2').show()
			};
			if(r.data.prizeid==6){
				$('#alert-yuan1').show()
			};
            if(r.data.prizeid==7){
				$('#alert-yuan5').show()
			};

		break;
		case '3':
		  // code=3,prizeid=>xx//三等奖
			$('#alert-third').show()
		break;
		case '4':
              if(r.data.prizeid==2){
              	$('#alert-second').show()
              };
              if(r.data.prizeid==1){
              	$('#alert-first').show()
              };
		break;
	}
}
localStorage.lotteryTimes = 1;
var click=false;
window.onload=function(){
	lottery.init('lottery');
	$("#lottery a").click(function(){
		if (click) {
			return false;
		}else{
			if(localStorage.lotteryTimes<1){
				return;
			}

		// 	var r = {};
		// 	r.data = {};
		// // console.log(r);
		// 		r.data.code = '1';
		// 		r.data.prizeid=4;
				lottery.speed=100;
				
				// setTimeout(lottery.roll(),lottery.speed);
				click=true;
				setStop();
				roll();
				localStorage.lotteryTimes--;
			// console.log('lalal')
			// activityQuery('Index.getGift',{
			// 	phone:'1364454653'
			// }, function(r){

			// 	// console.log(r);
			// 	lottery.speed=100;
			// 	roll();
			// 	click=true;
			// 	switch(r.data.code){
			// 		case '-4':
			// 		// 弹窗
			// 		break;
			// 		case '0':
			// 			lottery.stop(5);
			// 		break;
			// 		case '999999':

			// 		break;
			// 		case '-2':

			// 		$('#alert-empty').show();
			// 		break;
			// 		case '1':
			// 		  // code=1,prizeid=xx//优惠券
			// 			$('#alert-coupon').show()
			// 			// lottery.stop(0,2,4,6);
			// 			if(r.data.prizeid==4){
			// 				lottery.stop(6);
			// 			}
			// 		break;
			// 		case '3':
			// 		  // code=3,prizeid=>xx//三等奖
			// 			$('#alert-third').show()
			// 		break;
			// 		case '4':

			// 		break;
			// 	}
			// 	return false;
			// });
		}
	});
};





</script>
<!--效果html结束-->
<div class="clear"></div>

	</script>
</body>
</html>